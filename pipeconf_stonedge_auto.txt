# HAWC Pipeline Configuration Validation File - General (public) version
#
# 2008-11-3 Marc Berthoud Version 0.1: Configuration file for Pipeline Testing
# 2012 Marc Berthoud: Numerous updates
# 2013-10-09 Nicholas Chapman: Made a config validation file
# 2017-07-28 Atreyo Pal config file (added bdf section, removed KEYS)

# General Section: configuration of the pipeline
[general]
    # list of packages to look for pipe step modules (order matters)
    steppacks = stonesteps, drp
    # list of steps for unknown instrument mode
    stepslist = StepLoadStoneedge, StepDemod

# Data Section: information on data objects and file names
[data]
    # Regexp for part of the filename before the file step identifier
    # - default is '\A.+\.' for all filename before the last '.' including the '.'
    filenamebegin = "\A.+_[A-Za-z0-9]+\." # Stonedge: All before last '_', one more word and following '.'
    #filenamebegin = 'not-appl' # Uses bla.TypeID.fits
    # Regexp for part of the filename after the file step identifier
    # - default is '\.[A-Za-z0-9]+\Z' for alphanum characters after last '.'
    filenameend = '\.fits(\.gz)?\Z' # .fits with optional .gz
    #filenameend = 'not-applicable-use-fallback' # Uses .f* as filenameend
    dataobjects = DataFits, DataText #, DataCsv

# Pipeline Section: Configuration of the pipeline
[pipeline]
    # Number of final results to save
    finalsaveN = 5

### Pipelines Section: configuration for individual pipeline modes

# ChopNod Mode Configuration
[mode_stoneedge]
# List of keyword=values required in file header to select this pipeline mode
    #   Format is: Keyword=Value|Keyword=Value|Keyword=Value
    datakeys = "OBSERVAT=StoneEdge"
    # list of steps
    stepslist = load, StepAddKeys, StepAstrometrica, save, StepBiasDarkFlat, save, StepHotpix, StepRGB
    #stepslist = load, StepAddKeys, save, StepHotpix, StepRGBAuto

### Pipe Step Section

# Parent step configuration
[parent]
    # Sample parameter - no practical use
    sampar = 0.25

# Parent step Multiple Inputs configuration
[parentmi]
    # Sample parameter - no practical use
    sampar = 0.5

# Parent step Multiple Outputs configuration
[parentmo]
    # Sample parameter - no practical use
    sampar = 0.75


# BiasDarkFlat step configuration
[biasdarkflat]
    # filename that overrules the fit keys
    biasfile = /data/images/StoneEdge/0.5meter/2017/2017-07-25/bias/*.fits
    darkfile = /data/images/StoneEdge/0.5meter/2017/2017-07-25/dark/*.fits
    flatfile = /data/images/StoneEdge/0.5meter/2017/2017-07-25/flat/*.fits
    # list of keys that need to match bias and data file
    #fitkeys = ‘list’,’of’,’FIT Keywords’,’for Bias/Dark/Flat’ # StoneEdge
    biasfitkeys = XBIN  
    darkfitkeys = XBIN, EXPTIME
    flatfitkeys = XBIN, FILTER
    # list of input file datasets to flatten
    # - Expects None or a list of image HDU 
    #datalist = R array, T array

# Hotpix step configuration
[hotpix]

# Astrometrica Step Configuration
[astrometrica]
    # Command to call astrometrica, should contain 2 string
    # placeholders for intput and output file (default: cp %s %s)
    #astrocmd = '/data/scripts/astrometry/install/bin/solve-field --batch --no-plots --overwrite --continue --skip-solved --index-xyls none --axy none --temp-axy --solved none --match none --rdls none --corr none --pnm none --downsample 2 --scale-units arcsecperpix --scale-low 0.9 --scale-high 1.1 %s --out %s' # for 2016 camera 1536x1023 pixels
    astrocmd = '/data/scripts/astrometry/install/bin/solve-field --batch --no-plots --overwrite --continue --skip-solved --index-xyls none --axy none --temp-axy --solved none --match none --rdls none --corr none --pnm none --downsample 2 --scale-units arcsecperpix --guess-scale %s --out %s' # for 2017 camera 1024x1024 pixels
    # Flag to log full astrometrica output at DEBUG level
    verbose = True
    # Flag to delete temporary files generated by astrometrica
    delete_temp = True

# RGB step configuration
[makergb]
    # percentile value for miniumum scaling (in decimal form)
    minpercent = 0.5
    # percentile value for maximum scaling
    maxpercent = 0.999

### Data Handling Section

# Treatement of the FITS header: can include keyword replacement
# The keyword value and comment must be printed as they would in a FITS header
# If the value is another keyword, the value of that keyword will be used
# instead (This only works if the other keywords starts with an alphabetic
# character).
[header]
    INSTMODE = "stoneedge"
    COMPLETE = 1
    
# Treatement for table values when combining images
# Options are MIN, MED, AVG, FIRST, LAST, SUM
[table]
